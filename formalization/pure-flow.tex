\documentclass[10pt]{article}

\usepackage{amsmath}
\usepackage{hyperref}
\usepackage{tikz-cd}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{bm}
\usepackage{listings}
\usepackage{bbm}
\usepackage{multicol}
\usepackage{mathtools}
\usepackage{mathpartir}
\usepackage{float}
\usepackage[inline]{enumitem}
\usepackage[margin=1.25in]{geometry}
\usepackage[T1]{fontenc}
\usepackage{kpfonts}

\usetikzlibrary{decorations.pathmorphing}

\input{LaTeX/macros.tex}
\input{macros.tex}

\newcommand{\multiset}{\textbf{\texttt{multiset}}\xspace}

\begin{document}

\section{Specification}

\subsection{Syntax}
\begin{tabular}{l r l l}
    $\mathcal{Q}$, $\mathcal{R}$, $\mathcal{S}$ & \bnfdef & $\exactlyone$ \bnfalt $\any$ \bnfalt $\nonempty$ \bnfalt $\emptyq$ \bnfalt $\every$ \\
    $M$ & \bnfdef & \fungible \bnfalt \unique \bnfalt \immutable \bnfalt \consumable \bnfalt \asset & (type declaration modifiers) \\
    $T$ & \bnfdef & $\alpha \bnfalt \type~t~\is~\overline{M}~T \bnfalt \multiset~\tau \bnfalt \tau \to \tau \bnfalt \forall \alpha . \tau$ \\
    $\tau$, $\sigma$, $\pi$ & \bnfdef & $\mathcal{Q}~T$ \\
    $S$ & \bnfdef & $E$ \bnfalt $\mathcal{Q}~x : \tau~\suchthat~E$ \\
    $E$ & \bnfdef & $\emptyset \bnfalt \curlys{E} \bnfalt x \bnfalt \lambda x : \tau . E \bnfalt \Lambda \alpha . E \bnfalt E ~ E \bnfalt E[T] \bnfalt E \sends{E} E$ \\
\end{tabular}

\subsection{Statics}

\begin{mathpar}
    \inferrule*[right=EmptySet]{
    }{ \Gamma \flowproves \emptyset : \emptyq~\multiset~\tau \flowprovesout \Gamma }

    \inferrule*[right=Singleton]{
        \Gamma \flowproves E : \tau \flowprovesout \Delta
    }{ \Gamma \flowproves \curlys{E} : \,\,\exactlyone~\multiset~\tau \flowproves \Delta }

    \inferrule*[right=Demote-Var]{
    }{ \Gamma, x : \tau \flowproves x : \demote(\tau) \flowprovesout \Gamma, x : \tau }

    \inferrule*[right=Lin-Var]{
        (\mathcal{Q}~T)~\asset
    }{ \Gamma, x : \mathcal{Q}~T \flowproves x : \tau \flowprovesout \Gamma }

    \inferrule*[right=Lin-Abs]{
        \Gamma, x : \tau \flowproves E : \sigma \flowprovesout \Delta
        \\
        \tau~\asset
        \\
        (x \not\in \dom(\Delta) \lor \lnot(\Delta(x)~\asset))
    }{ \Gamma \flowproves (\lambda x : \tau . E) : \,\,\exactlyone~(\tau \to \sigma) \flowprovesout \Gamma }

    \inferrule*[right=Any-Abs]{
        \Gamma, x : \tau \flowproves E : \sigma \flowprovesout \Gamma, x : \tau
        \\
        \lnot(\tau~\asset)
    }{ \Gamma \flowproves (\lambda x : \tau . E) : \every~(\tau \to \sigma) \flowprovesout \Gamma }

    \inferrule*[right=App]{
        \Gamma \flowproves f : \mathcal{Q}~(\tau \to \sigma) \flowprovesout \Delta[f \leftarrow \Delta(f) \ominus !]
        \\
        \Delta[f \leftarrow \Delta(f) \ominus !] \flowproves e : \tau \flowprovesout \Xi
        \\
        \mathcal{Q} \neq \emptyq
    }{ \Gamma \flowproves f e : \sigma \flowprovesout \Xi }

    \inferrule*[right=T-Abs]{
        \Gamma, \alpha \flowproves e : \tau \flowprovesout \Delta
    }{ \Gamma \flowproves (\Lambda \alpha . e) : \,\,\exactlyone~(\forall \alpha . \tau) \flowprovesout \Delta }

    \inferrule*[right=T-App]{
        \Gamma \flowproves f : \,\,\exactlyone~(\forall \alpha . \tau) \flowprovesout \Delta
    }{ \Gamma \flowproves f[T] : \tau[T / \alpha] \flowprovesout \Delta }

    \inferrule*[right=Flow-Lit]{
        \Gamma \flowproves A : \mathcal{Q}~\multiset~\tau \flowprovesout \Delta
        \\
        \Delta \flowproves s : \mathcal{R}~\multiset~\demote(\tau) \flowprovesout \Delta
        \\
        \Delta \flowproves B : \mathcal{S}~\multiset~\tau \flowprovesout \Xi
    }{ \Gamma \flowproves (A \sends{s} B) : \,\,\exactlyone~\forall \alpha. \,\,\exactlyone~((\mathcal{Q} \ominus \mathcal{R})~\multiset~\tau
                                                                        \to \,\,\exactlyone~((\mathcal{S} \oplus \mathcal{R})~\multiset~\tau \to \alpha)) \flowprovesout \Xi }

    \inferrule*[right=Flow-Filter]{
        \Gamma \flowproves A : \mathcal{Q}~\multiset~\tau \flowprovesout \Delta
        \\
        \Delta, x : \tau \flowproves E : \,\,\exactlyone~\boolt \flowprovesout \Delta
        \\
        \Delta \flowproves B : \mathcal{S}~\multiset~\tau \flowprovesout \Xi
    }{ \Gamma \flowproves (A \sends{\mathcal{R}~x : \tau~\suchthat~E} B) : \,\,\exactlyone~\forall \alpha. \,\,\exactlyone~((\mathcal{Q} \ominus \mathcal{R})~\multiset~\tau
                                                                        \to \,\,\exactlyone~((\mathcal{S} \oplus \mathcal{R})~\multiset~\tau \to \alpha)) \flowprovesout \Xi }
\end{mathpar}

\subsection{Dynamics}
\begin{tabular}{l r l l}
    $\mathcal{V}$ & \bnfdef & $\{\overline{\mathcal{V}}\}$
\end{tabular}

\begin{mathpar}
    \inferrule*[right=App-Congr]{
        f \to f'
    }{ f e \to f' e }

    \inferrule*[right=$\beta$-Red]{
    }{ (\lambda x : \tau . e) a \to e[a / x] }

    \inferrule*[right=TApp-Congr]{
        f \to f'
    }{ f[\tau] \to f'[\tau] }

    \inferrule*[right=T-$\beta$-Red]{
    }{ (\Lambda \alpha . e)[T] \to e[T / \alpha] }
\end{mathpar}

\end{document}

